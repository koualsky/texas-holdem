{% extends "game/base.html" %}
{% load game_extras %}

{% block content %}

<a href="{% url 'play' %}">Refresh</a>
|
<a href="{% url 'exit' %}">Exit game</a>
<h4>Pool: {{ table.pool }}</h4>
<h4>Cards on table: {{ table.cards_on_table }}</h4>
<h4>Game state: {{ table.game_state }}</h4>



<table>
    <tr>
        <td><!-- Dealer --></td>
        <td>Player</td>
        <td>Money</td>
        <td>Cards</td>
        <td>Rate</td>
        <td>State</td>
    </tr>

    {% for player in players_list %}
    <tr>
        <!-- Show who have dealer button if this button is in table. RELATED? ;) -->
        <td>
            {% if table.game_state != 'ready' and table.dealer == player %} D {% endif %}
            {% if table.game_state != 'ready' and table.small_blind == player %} s {% endif %}
            {% if table.game_state != 'ready' and table.big_blind == player %} b {% endif %}
        </td>

        <!-- This part of code is only for styling -->
        {% if player.state == 'out' %}
        <td style="color: grey;">{{ player }}</td>
        <td style="color: grey;">{{ player.money }}</td>
        <td style="color: grey;">{{ player.cards }}</td>
        <td style="color: grey;">{{ player.round_money }}</td>
        {% else %}
        <td>{{ player }}</td>
        <td>{{ player.money }}</td>
        <td>{{ player.cards }}</td>
        <td>{{ player.round_money }}</td>
        {% endif %}


        <td style="color: grey;">

             <!-- If you are you AND you dont select decission yet AND is your turn - you can make decission now -->
            {% if request.user.player == player and table.decission == player %}

                <!-- This button shows when all players have the same round_money -->
                {% if request.user.player.round_money == table.biggest_rate %}
                    <a href="{% url 'check' %}">check</a>

                <!-- This button shows when you have to add to game pool  -->
                {% else %}
                    <a href="{% url 'check' %}">call</a>
                {% endif %}

                <form action="/raise/" method="POST" style="float:left;">{% csrf_token %}
                    <input id="how_much" name="how_much" type="number" value={{ table.biggest_rate|subtract:request.user.player.round_money }} min="1" max="{{ request.user.player.money }}" style="width:40px;">
                    <button type="submit">raise</button>
                </form>

                <a href="{% url 'pass' %}">pass</a>
            {% endif %}

            <!-- Show who turn is now -->
            {% if table.decission == player %}
                (you!)
            <!-- If you aren't you, show him status -->
            {% else %}
                {{ player.state }}
            {% endif %}

        </td>
    </tr>
    {% endfor %}

</table>

{% endblock %}