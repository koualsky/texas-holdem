{% extends "game/base.html" %}
{% load game_extras %}

{% block content %}

<a href="{% url 'play' %}" xmlns:table.biggest_rate>Refresh</a>
|
<a href="{% url 'exit' %}">Exit game</a>
<!-- <h6 style="color: lightgrey;">Deck: {{ table.print_pretty_cards_deck }}</h6> -->
<h4>Cards on table: {{ table.print_pretty_cards_on_table }}</h4>
<h4>Pool: {{ table.pool }}</h4>
<h4>Game state: {{ table.game_state }}</h4>



<table>
    <tr>
        <td><!-- Dealer --></td>
        <td>Player</td>
        <td>Money</td>
        <td>Rate</td>
        <td>Cards</td>
        <td>State</td>
    </tr>

    {% for player in players_list %}
    <tr>
        <!-- Show who have dealer button if this button is in table. RELATED? ;) -->
        <td>
            {% if table.game_state != 'ready' and table.dealer == player %} D {% endif %}
            {% if table.game_state != 'ready' and table.small_blind == player %} s {% endif %}
            {% if table.game_state != 'ready' and table.big_blind == player %} b {% endif %}
        </td>

        <!-- This part of code is only for styling -->
        {% if player.state == 'out' %}
            <td style="color: grey;">{{ player }}</td>
            <td style="color: grey;">{{ player.money }}</td>
            <td style="color: grey;">{{ player.round_money }}</td>
            <td style="color: grey;">{{ player.print_pretty_cards_cards }}</td>
        {% else %}
            <td>{{ player }}</td>
            <td>{{ player.money }}</td>
            <td>{{ player.round_money }}</td>
            <td>
                <!-- Player can see only itself cards -->
                {% if request.user.player == player %}
                    {{ player.print_pretty_cards_cards }}
                    {{ player.my_hand }}
                {% elif player.cards != None %}
                    [---], [---]
                {% endif %}
            </td>
        {% endif %}


        <td style="color: grey;">

             <!-- If game_state != winner
                  - make decisions -->

            {% if request.user.player.table.game_state != 'winner' %}

                {% if request.user.player == player and table.decission == player %}

                    <!-- This button shows when all players have the same round_money -->
                    {% if request.user.player.round_money == table.biggest_rate %}
                        <a href="{% url 'check' %}">check</a>

                    <!-- This button shows when you have to add to game pool  -->
                    {% else %}
                        <a href="{% url 'check' %}">call</a>
                    {% endif %}

                    <form action="/raise/" method="POST" style="float:left;">{% csrf_token %}
                        <input id="how_much" name="how_much" type="number" value={{ table.biggest_rate|subtract:request.user.player.round_money }} min="1" max="{{ request.user.player.money }}" style="width:40px;">
                        <button type="submit">raise</button>
                    </form>

                    <a href="{% url 'pass' %}">pass</a>
                {% endif %}
            {% endif %}



            <!-- Show who turn is now -->
            {% if table.decission == player %}
                {% if request.user.player != player %}
                    ( ! )
                {% endif %}
            <!-- If you aren't you, show him status -->
            {% else %}
                {% if player.state != 'start' %}
                    {{ player.state }}
                {% endif %}
            {% endif %}
        </td>
    </tr>
    {% endfor %}

</table>

<!-- Hide line below until game state achieve 'winner' state -->
{% if request.user.player.table.game_state == 'winner' %}<p>THE WINNER IS: {{ table.the_winner }}</p>{% endif %}
{% if request.user.player.table.game_state == 'winner' %}<a href="{% url 'check' %}">Play again</a>{% endif %}

{% endblock %}