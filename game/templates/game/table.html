{% extends "game/base.html" %}
{% load game_extras %}

{% block content %}



<nav class="navbar navbar-dark bg-dark p-0 m-0">
{% if user.is_authenticated %}

    <a class="navbar-text text-light pl-3">{{ user }}: <span id="player_money">{{ request.user.player.money }}</span> $</a>
    <div class="btn-group">
        <a href="{% url 'play' %}" class="btn btn-success my-0 my-sm-0">Refresh</a>
        <a href="{% url 'exit' %}" class="btn btn-danger my-0 my-sm-0">Exit game</a>
    </div>

{% endif %}
</nav>




<!-- 1. ALL PLAY SCREEN: POOL, BOARD AND PLAYERS CARDS -->
<div class="container" style="max-width: 414px;">
    <h3 class="text-center text-secondary pb-2 pt-3">Pool: <span id="pool">{{ table.pool }}</span> $</h3>
    <!-- bylo <p> -->
    <div class="d-flex justify-content-center text-center align-items-center" style="cursor: default;">Board: <span class="d-flex" id="board_cards">{{ table.print_pretty_cards_on_table }}</span></div>
    <!-- <h4>Game state: {{ table.game_state }}</h4> -->


{% for player in players_list %}
    <div class="row">

        <!-- PLAYER IS IN THE GAME -->
        {% if player.state == 'out' %}

            <!-- DEALER, PLAYER, MONEY -->
            <div class="col text-secondary text-right">
                {% if table.game_state != 'ready' and table.dealer == player %} D {% endif %}
                {% if table.game_state != 'ready' and table.small_blind == player %} s {% endif %}
                {% if table.game_state != 'ready' and table.big_blind == player %} b {% endif %}
                {{ player }} ({{ player.money }} $)
            </div>

            <!-- CARDS -->
            <div class="col-5 text-secondary">{{ player.print_pretty_cards_cards }}</div>

            <!-- RATE -->
        <div class="col-1 text-secondary">{{ player.round_money }}</div>

        <!-- PLAYER IS OUT OF THE GAME -->
        {% else %}

            <!-- DEALER, PLAYER, MONEY -->
            <div class="col d-flex text-right align-items-center">
                {% if table.game_state != 'ready' and table.dealer == player %} D {% endif %}
                {% if table.game_state != 'ready' and table.small_blind == player %} s {% endif %}
                {% if table.game_state != 'ready' and table.big_blind == player %} b {% endif %}

                {{ player }} ({{ player.money }} $)
            </div>

            <!-- CARDS -->
            <div class="col-5 d-flex justify-content-center text-center align-items-center" style="cursor: default;">
                <!-- Player can see only itself cards -->
                {% if request.user.player == player or table.game_state == 'winner' %}
                    <span class="d-flex" id="player_cards">{{ player.print_pretty_cards_cards }}</span>
                    {{ player.my_hand }}
                    {% elif player.cards != None %}
                    <span class="d-flex">
                        <div class="card container-fluid m-1" style="width: 2rem; height: 3rem;"></div>
                        <div class="card container-fluid m-1" style="width: 2rem; height: 3rem;"></div>
                    </span>
                {% endif %}
            </div>

            <!-- RATE -->
            <div class="col-1 d-flex align-items-center">{{ player.round_money }}</div>
        {% endif %}

        <div class="col-2 d-flex align-items-center">

            <!-- STATE -->
            <!-- Show who turn is now -->
            {% if table.decission == player %}
                {% if request.user.player != player %}

                    <!-- BEFORE: ( ! ) -->
                    <div class="spinner-grow spinner-grow-sm" role="status">
                        <span class="sr-only">( ! )</span>
                    </div>
                {% endif %}
            <!-- If you aren't you, show him status -->
            {% else %}
                {% if player.state != 'start' %}
                    {{ player.state }}
                {% endif %}
            {% endif %}

        </div>
    </div>
{% endfor %}
</div>



<!-- 2. DECISSION IF YOUR'S TURN -->
<div class="container-fluid fixed-bottom text-center mb-3" style="max-width: 414px;">
{% for player in players_list %}

    <!-- CHECK / CALL / RAISE -->
    {% if request.user.player.table.game_state != 'winner' %}
        {% if request.user.player == player and table.decission == player %}

            <form action="/raise/" method="POST" class="float-none d-inline text-center">{% csrf_token %}

                <div class="form-group p-1 text-center">

                    <div class="input-group mb-3 text-center">
                        <input class="form-control text-center" id="how_much" name="how_much" type="number" value="{{ table.biggest_rate|subtract:request.user.player.round_money }}" min="{{ table.biggest_rate|subtract:request.user.player.round_money }}" max="{{ request.user.player.money }}">
                        <div class="input-group-append">
                            <span class="input-group-text" id="basic-addon2">$</span>
                        </div>
                    </div>


                    <input type="range" class="custom-range form-control-range" min="{{ table.biggest_rate|subtract:request.user.player.round_money }}" max="{{ request.user.player.money }}" value="{{ table.biggest_rate|subtract:request.user.player.round_money }}" id="formControlRange">
                </div>

                <!-- 1. Span is for JS functionality -->
                <span id="raise_button"></span>
            </form>

            <!-- 2. Span is for JS functionality -->
            <span id="check_call_buttons">
            <!-- This button shows when all players have the same round_money -->
            {% if request.user.player.round_money == table.biggest_rate %}
                <a href="{% url 'check' %}" class="btn btn-lg btn-success">check</a>
                <!-- This button shows when you have to add to game pool  -->
            {% else %}
                <a href="{% url 'check' %}" class="btn btn-lg btn-success">call</a>
            {% endif %}
            </span>

        {% endif %}
    {% endif %}

    <!-- PASS -->
    {% if request.user.player.table.game_state != 'winner' %}
        {% if request.user.player == player and table.decission == player %}
            <a href="{% url 'pass' %}" class="btn btn-lg btn-danger">pass</a>
        {% endif %}
    {% endif %}
{% endfor %}
</div>






<!-- Hide line below until game state achieve 'winner' state -->
{% if request.user.player.table.game_state == 'winner' %}<p>THE WINNER IS: {{ table.the_winner }}</p>{% endif %}
{% if request.user.player.table.game_state == 'winner' %}<a href="{% url 'check' %}">Play again</a>{% endif %}

{% endblock %}

